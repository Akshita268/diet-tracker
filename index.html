<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Discipline Ledger</title>

<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="apple-touch-icon" sizes="512x512" href="icon-512.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#020617">

<style>
:root{
  --bg:#020617;--card:#0f172a;
  --green:#16a34a;--yellow:#facc15;
  --orange:#f97316;--red:#dc2626;--gold:#fbbf24;
}
*{box-sizing:border-box;font-family:Inter,system-ui,sans-serif}
body{
  margin:0;background:radial-gradient(circle at top,#0f172a,#020617);
  color:#fff;min-height:100vh
}
.app{
  max-width:380px;margin:auto;
  background:var(--card);
  border-radius:22px;padding:20px;
  border:1px solid #334155;
}
h1{text-align:center;color:var(--gold);margin:8px 0}
button{
  width:100%;padding:14px;border-radius:12px;
  border:none;font-weight:800;margin-bottom:10px;cursor:pointer
}
.clean{background:var(--green)}
.junk{background:var(--red)}
.secondary{
  background:#020617;color:#94a3b8;border:1px solid #334155
}
.hidden{display:none}
.msg{text-align:center;font-style:italic;min-height:40px}

/* Calendar */
.calendar-screen{
  position:fixed;inset:0;background:var(--bg);
  padding:20px;z-index:10
}
.cal-header{
  display:flex;justify-content:space-between;
  align-items:center;margin-bottom:10px
}
.cal-header h2{margin:0}
.grid{
  display:grid;grid-template-columns:repeat(7,1fr);
  gap:6px;font-size:12px
}
.day{
  text-align:center;padding:10px 0;
  border-radius:8px;background:#020617;
  border:1px solid #334155
}
.clean-day{background:var(--green)}
.low-day{background:var(--yellow);color:#000}
.medium-day{background:var(--orange)}
.high-day{background:var(--red)}
</style>
</head>

<body>
<div class="app">
  <h1>DISCIPLINE LEDGER</h1>

  <button class="clean" onclick="markClean()">‚úî I STAYED CLEAN TODAY</button>
  <button class="junk" onclick="showLevels()">‚úñ I ATE JUNK TODAY</button>

  <div id="levels" class="hidden">
    <button class="junk" onclick="markJunk('low')">Low junk (skip 1 meal)</button>
    <button class="junk" onclick="markJunk('medium')">Medium junk (skip 2 meals)</button>
    <button class="junk" onclick="markJunk('high')">High junk (skip 3 meals + exercise)</button>
  </div>

  <div class="msg" id="msg">No report yet today.</div>

  <button class="secondary" onclick="openCalendar()">üìÖ Calendar</button>
</div>

<!-- Calendar Screen -->
<div id="calendarScreen" class="calendar-screen hidden"
     ontouchstart="startSwipe(event)" ontouchend="endSwipe(event)">
  <div class="cal-header">
    <button class="secondary" onclick="closeCalendar()">‚Üê Back</button>
    <h2 id="monthYear"></h2>
    <span></span>
  </div>
  <div class="grid" id="calendarGrid"></div>
</div>

<script>
const KEY="disciplineData";
let data=JSON.parse(localStorage.getItem(KEY))||{};
let current=new Date();
let touchX=0;

const today=()=>new Date().toISOString().slice(0,10);

function save(){localStorage.setItem(KEY,JSON.stringify(data))}

function markClean(){
  data[today()]={status:"clean"};
  document.getElementById("msg").textContent="Clean day recorded.";
  save();
}
function showLevels(){
  document.getElementById("levels").classList.toggle("hidden");
}
function markJunk(level){
  data[today()]={status:"junk",level};
  document.getElementById("levels").classList.add("hidden");
  document.getElementById("msg").textContent=
    `Junk (${level}) recorded.`;
  save();
}

/* Calendar logic */
function openCalendar(){
  document.getElementById("calendarScreen").classList.remove("hidden");
  renderCalendar();
}
function closeCalendar(){
  document.getElementById("calendarScreen").classList.add("hidden");
}

function renderCalendar(){
  const grid=document.getElementById("calendarGrid");
  grid.innerHTML="";
  const year=current.getFullYear();
  const month=current.getMonth();
  document.getElementById("monthYear").textContent=
    current.toLocaleString("default",{month:"long",year:"numeric"});

  const days=new Date(year,month+1,0).getDate();
  for(let d=1;d<=days;d++){
    const date=new Date(year,month,d).toISOString().slice(0,10);
    const cell=document.createElement("div");
    cell.className="day";
    cell.textContent=d;

    if(data[date]){
      if(data[date].status==="clean")cell.classList.add("clean-day");
      if(data[date].level==="low")cell.classList.add("low-day");
      if(data[date].level==="medium")cell.classList.add("medium-day");
      if(data[date].level==="high")cell.classList.add("high-day");
    }
    grid.appendChild(cell);
  }
}

/* Swipe */
function startSwipe(e){touchX=e.changedTouches[0].screenX}
function endSwipe(e){
  let dx=e.changedTouches[0].screenX-touchX;
  if(dx>50){current.setMonth(current.getMonth()-1)}
  if(dx<-50){current.setMonth(current.getMonth()+1)}
  renderCalendar();
}

renderCalendar();
</script>
</body>
</html>
