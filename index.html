<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Discipline Quest</title>

<link rel="manifest" href="manifest.json">

<!-- iOS ICON FIX -->
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="apple-touch-icon" sizes="512x512" href="icon-512.png">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="theme-color" content="#020617">

<style>
:root{
  --bg:#020617;--card:#1e293b;
  --danger:#dc2626;--success:#16a34a;--gold:#fbbf24;
}
*{box-sizing:border-box;font-family:Inter,system-ui,sans-serif}
body{
  margin:0;background:radial-gradient(circle at top,#0f172a,#020617);
  color:#fff;display:flex;justify-content:center;align-items:center;min-height:100vh
}
.app{
  width:380px;background:var(--card);border-radius:22px;
  padding:22px;border:1px solid #334155;
  box-shadow:0 0 40px rgba(0,0,0,.6);position:relative;overflow:hidden
}
.app.good{box-shadow:0 0 40px rgba(22,163,74,.6)}
.app.bad{animation:shake .3s}

@keyframes shake{
  0%{transform:translateX(0)}
  25%{transform:translateX(-6px)}
  50%{transform:translateX(6px)}
  75%{transform:translateX(-6px)}
  100%{transform:translateX(0)}
}

.badge{
  background:rgba(220,38,38,.15);color:var(--danger);
  padding:6px 14px;border-radius:999px;font-size:11px;
  font-weight:700;display:inline-block;margin-bottom:10px
}
h1{text-align:center;margin:8px 0;color:var(--gold);letter-spacing:1px}

.bar{background:#0f172a;border-radius:12px;overflow:hidden;margin:10px 0}
.bar-fill{height:14px;background:linear-gradient(90deg,var(--success),#22c55e);transition:.4s}

.stats{display:flex;justify-content:space-between;font-size:12px;color:#cbd5f5}

.timer{text-align:center;margin:14px 0;color:var(--gold);font-size:13px}

button{
  width:100%;padding:16px;border-radius:14px;border:none;
  font-weight:800;letter-spacing:.5px;cursor:pointer
}
.clean{background:var(--success);color:#fff;margin-bottom:10px}
.junk{background:var(--danger);color:#fff}
button:disabled{opacity:.4}

.msg{min-height:48px;text-align:center;font-style:italic;color:var(--danger);margin-top:12px;font-size:13px}
</style>
</head>

<body>
<div class="app" id="app">
  <div class="badge">STRICT MODE</div>
  <h1>DISCIPLINE QUEST</h1>

  <div class="stats">
    <div>Score: <b id="score">1000</b></div>
    <div>Streak: <b id="streak">0</b></div>
  </div>

  <div class="bar"><div class="bar-fill" id="healthBar"></div></div>

  <div class="timer" id="timer">Waiting for check-in…</div>

  <button class="clean" id="cleanBtn">✔ I STAYED CLEAN</button>
  <button class="junk" id="junkBtn">✖ I ATE JUNK</button>

  <div class="msg" id="msg"></div>
</div>

<script>
const ONE_HOUR=3600000,KEY="disciplineData";
const SCOLDS=[
 "That was weakness, not hunger.",
 "You traded health for a moment.",
 "Discipline lost this round.",
 "You knew better."
];

let s=JSON.parse(localStorage.getItem(KEY))||{
 score:1000,streak:0,clean:0,last:0,notified:false
};

const $=id=>document.getElementById(id);
const app=$("app");

function save(){localStorage.setItem(KEY,JSON.stringify(s))}

function ui(){
 $("score").textContent=s.score;
 $("streak").textContent=s.streak;
 $("healthBar").style.width=Math.min(100,s.score/10)+"%";

 const now=Date.now(),d=now-s.last;
 if(!s.last||d>=ONE_HOUR){
   $("cleanBtn").disabled=false;
   $("junkBtn").disabled=false;
   $("timer").textContent="⏱ CHECK-IN REQUIRED";
 }else{
   $("cleanBtn").disabled=true;
   $("junkBtn").disabled=true;
   let r=ONE_HOUR-d;
   $("timer").textContent=`Next check-in in ${Math.floor(r/60000)}m ${Math.floor(r%60000/1000)}s`;
 }
 save();
}

$("cleanBtn").onclick=()=>{
 s.last=Date.now();s.score+=10;s.clean++;
 app.classList.add("good");
 setTimeout(()=>app.classList.remove("good"),300);
 $("msg").textContent="Good. Discipline held.";
 if(s.clean===6){s.streak++;s.clean=0}
 ui();
};

$("junkBtn").onclick=()=>{
 s.last=Date.now();s.score-=200;s.streak=0;s.clean=0;
 $("msg").textContent=SCOLDS[Math.random()*SCOLDS.length|0];
 app.classList.add("bad");
 setTimeout(()=>app.classList.remove("bad"),300);
 ui();
};

setInterval(ui,1000);
ui();
</script>
</body>
</html>
